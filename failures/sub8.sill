sub : {&{red: 1; blue: 1}};;
'c <- sub =
  case 'c of
  | red -> close 'c
  | blue -> close 'c;;

sup : {&{red: 1}};;
'c <- sup =
  case 'c of
  | red -> close 'c;;

recsup : {{&{red: 1; blue: 1}}=>1};;
'c <- recsup =
  m <- recv 'c;
  'd <- m;
  'd.blue;
  wait 'd;
  close 'c;;

go : {{&{red: 1}}=>1} -> {1};;
'c <- go foo = 
  'd <- foo;
  send 'd sup;
  wait 'd;
  close 'c;;
   
'top <- 
  'c <- go recsup;
  wait 'c;
  close 'top;;
